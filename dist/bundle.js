(()=>{"use strict";var e={148:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.checkRowsAndColumns=t.checkGrid=void 0;var n=r(12);t.checkGrid=function(){var e;return null==(0,n.getCurrentGrid)()?(e="something went wrong with fetching the grid :S",alert(e),e):!0!==o()?(e="the grid is not fully filled :S",alert(e),e):!0!==i()&&!0!==l()?(e="the grid is incorrect :S",alert(e),e):(e="the grid is correct :D. Well done!",alert(e),e)};var o=function(){for(var e=(0,n.getCurrentGrid)(),t=0;t<9;t++)for(var r=0;r<9;r++)if(null==e[t][r])return!1;return!0},i=function(){for(var e=(0,n.getCurrentGrid)(),t=new Array(9).fill(0),r=new Array(9).fill(0),o=0;o<9;o++){t.fill(0),r.fill(0);for(var i=0;i<9;i++){var l=e[o][i],u=e[i][o];if(t[l-1]++,r[u-1]++,1!=t[l-1])return!1;if(1!=r[u-1])return!1}}return!0};t.checkRowsAndColumns=i;var l=function(){return 1==u(0,2,0,2)&&1==u(0,2,3,5)&&1==u(0,2,6,8)&&1==u(3,5,0,2)&&1==u(3,5,6,8)&&1==u(3,5,0,2)&&1==u(5,8,0,2)&&1==u(5,8,3,5)&&1==u(5,8,5,8)},u=function(e,t,r,o){for(var i=(0,n.getCurrentGrid)(),l=new Array(9).fill(0),u=e;u<=t;u++)for(var a=r;a<=o;a++){var c=i[u][a];if(l[c-1]++,l[c-1]>1)return!1}return!0}},12:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getCurrentGrid=void 0,t.getCurrentGrid=function(){for(var e=[],t=0;t<9;t++)e[t]=new Array(9).fill(null);var r=document.querySelectorAll(".cell");if(null==r)return null;for(t=0;t<=8;t++)for(var n=0;n<=8;n++){var o=r[9*t+n];if(!(o instanceof HTMLElement))return null;if(!o)return null;var i=o.innerText;e[t][n]=Number(i)}return e}},483:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.deleteBoard=t.clearBoard=void 0;var n=r(945),o=function(){var e=document.getElementById("grid");if(null!==e)for(;e.lastChild;)e.removeChild(e.lastChild)};t.deleteBoard=o,t.clearBoard=function(){o(),(0,n.createBoard)(function(){for(var e=[],t=0;t<9;t++)e[t]=new Array(9).fill(null);return e}())}},945:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createBoard=void 0;var n=r(295);t.createBoard=function(e){var t=document.getElementById("grid");null!=t&&e.forEach((function(e,r){var n=document.createElement("div");null!==n&&(n.classList.add("row"),n.setAttribute("row","".concat(r)),2!==r&&5!==r||n.classList.add("underline"),t.append(n),e.forEach((function(e,t){var i=document.createElement("div");null!==i&&(i.setAttribute("row","".concat(r)),i.setAttribute("column","".concat(t)),i.classList.add("cell"),2!=t&&5!=t||i.classList.add("rightline"),null===e||0===e?(i.setAttribute("type","button"),i.addEventListener("click",o)):i.innerText=e.toString(),n.append(i))})))}))};var o=function(e){var t=e.target;if(t instanceof HTMLElement){var r=t.getAttribute("row"),o=t.getAttribute("column"),i=document.querySelector('[row="'.concat(r,'"][column="').concat(o,'"]'));if(i instanceof HTMLElement){var l;do{var u=prompt("Enter a number between 1 and 9:");if(null===u)return;l=Number.parseInt(u)}while(isNaN(Number(l)));if(!isNaN(Number(l))&&null!==i){var a;a=""===i.innerHTML?0:Number.parseInt(i.innerHTML),i.innerText=l.toString(),n.undoStack.push([Number.parseInt(r),Number.parseInt(o),a])}}}}},295:function(e,t){var r,n=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.undoStep=t.undoStack=void 0;var o=new(function(e){function t(t){void 0===t&&(t=1/0);var r=e.call(this)||this;return r.capacity=t,r}return n(t,e),t.prototype.push=function(e){if(this.isFull())throw Error("Stack has reached max capacity, you cannot add more items");this.storage.push(e)},t.prototype.pop=function(){return this.storage.pop()},t.prototype.peek=function(){return this.storage[this.size()-1]},t.prototype.isFull=function(){return this.capacity===this.size()},t}(function(){function e(){this.storage=[]}return e.prototype.size=function(){return this.storage.length},e}()));t.undoStack=o,t.undoStep=function(){if(null===o.peek()||void 0===o.peek()){var e="undoStack is null or undefined";return alert(e),e}if(0===o.size())return e="the undoStack is not yet built",alert(e),e;var t=o.pop();if(3!==t.length)return e="something went wrong with fetching an undoStack-element",alert(e),e;var r=document.querySelector('[row="'.concat(t[0],'"][column="').concat(t[1],'"]'));return console.log("undid row ".concat(t[0]+1," column ").concat(t[1]+1," from ").concat(r.innerHTML," to ").concat(t[2])),0===t[2]?r.innerHTML="":r.innerHTML=t[2].toString(),"good work mate"}},910:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.testNakedSingle=void 0,t.testNakedSingle=[[0,1,0,0,0,0,0,0,0],[0,0,0,0,1,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0]]},291:function(e,t){var r=this&&this.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var n,o=0,i=t.length;o<i;o++)!n&&o in t||(n||(n=Array.prototype.slice.call(t,0,o)),n[o]=t[o]);return e.concat(n||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.Cell=void 0;var n=function(){function e(e,t,r){void 0===e&&(e=null),void 0===t&&(t=null),void 0===r&&(r=null),this.row=e,this.column=t,this.box=null===e||null===t?null:3*Math.floor(this.row/3)+Math.floor(this.column/3),this.possibleValues=r}return e.prototype.getRow=function(){return this.row},e.prototype.getColumn=function(){return this.column},e.prototype.getBox=function(){return this.box},e.prototype.getPossibleValues=function(){return this.possibleValues},e.prototype.setPossibleValues=function(e){this.possibleValues=e},e.prototype.clone=function(){return new e(this.row,this.column,r([],this.possibleValues,!0))},e}();t.Cell=n},84:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.findNumbers=void 0;var n=r(512),o=r(770),i=r(291),l=function(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0};t.findNumbers=function(e){var t,r=u(e),n=0;do{t=!1;for(var o=0;o<r.length;o++){var i=r[o],c=i.getPossibleValues(),s=a(i.clone(),e);if(1===s.length){var d=s[0],f=i.getRow(),v=i.getColumn();e[f][v]=d,r.splice(o,1),o--,t=!0}else l(c,s)||(i.setPossibleValues(s),t=!0)}console.log("".concat(n)),n++}while(r.length>0&&t&&n<100);return e};var u=function(e){for(var t=[],r=0;r<=8;r++)for(var n=0;n<=8;n++)if(0===e[r][n]){var o=new i.Cell(r,n,[1,2,3,4,5,6,7,8,9]);t.push(o)}return t},a=function(e,t){var r=[1,2,3,4,5,6,7,8,9];return e.getPossibleValues().length>1&&(r=(0,o.applyNakedSingle)(e,t)),e.getPossibleValues().length>1&&(r=(0,n.applyHiddenSingle)(e,t)),r}},512:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.applyHiddenSingle=void 0;var n=r(291);t.applyHiddenSingle=function(e,t){for(var r=e.getRow(),o=e.getColumn(),i=(e.getBox(),e.getPossibleValues()),l=function(e){if(e!==o&&0===t[r][e]){var l=new n.Cell(r,e,[t[r][e]]).getPossibleValues();i.forEach((function(e){if(l.includes(e)){var t=i.indexOf(e);i.splice(t,1)}}))}},u=0;u<9;u++)l(u);for(var a=function(e){if(e!==r&&0===t[e][o]){var l=new n.Cell(e,o,[t[e][o]]).getPossibleValues();i.forEach((function(e){if(l.includes(e)){var t=i.indexOf(e);i.splice(t,1)}}))}},c=0;c<9;c++)a(c);var s=3*Math.floor(r/3),d=3*Math.floor(o/3);for(c=s;c<s+3;c++){var f=function(e){if(c!==r&&e!==o&&0===t[c][e]){var l=new n.Cell(c,e,[t[c][e]]).getPossibleValues();i.forEach((function(e){if(l.includes(e)){var t=i.indexOf(e);i.splice(t,1)}}))}};for(u=d;u<d+3;u++)f(u)}return e.setPossibleValues(i),i}},770:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.applyNakedSingle=void 0,t.applyNakedSingle=function(e,t){for(var r=e.getRow(),n=e.getColumn(),o=e.getBox(),i=e.getPossibleValues(),l=0;l<9;l++)if(0!==(d=t[r][l])&&i.includes(d)){var u=i.indexOf(d);i.splice(u,1)}for(var a=0;a<9;a++)0!==(d=t[a][n])&&i.includes(d)&&(u=i.indexOf(d),i.splice(u,1));var c=3*Math.floor(o/3),s=o%3*3;for(a=c;a<c+3;a++)for(l=s;l<s+3;l++){var d;0!==(d=t[a][l])&&i.includes(d)&&(u=i.indexOf(d),i.splice(u,1))}return i}},659:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.solveGrid=void 0;var n=r(12),o=r(84),i=r(483),l=r(945);t.solveGrid=function(){var e=(0,n.getCurrentGrid)(),t=(0,o.findNumbers)(e);(0,i.deleteBoard)(),(0,l.createBoard)(t)}}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n].call(i.exports,i,i.exports,r),i.exports}(()=>{var e=r(148),t=r(945),n=r(483),o=r(295),i=r(910),l=r(659),u=document.getElementById("clear");null!==u?u.addEventListener("click",n.clearBoard):alert("we've got a problem with the check button :/");var a=document.getElementById("check");null!==a?a.addEventListener("click",e.checkGrid):alert("we've got a problem with the check button"),window.addEventListener("keydown",(function(e){"z"===e.key&&!0===e.ctrlKey&&(e.preventDefault(),(0,o.undoStep)())}));var c=document.getElementById("undo");null!==c?c.addEventListener("click",o.undoStep):alert("we've got a problem with the undo button");var s=document.getElementById("solve");null!==s||void 0!==s?s.addEventListener("click",l.solveGrid):alert("we've got a problem with the undo button"),(0,t.createBoard)(i.testNakedSingle)})()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LEVBQW9CSixHQUFVSyxLQUFLRixFQUFPRCxRQUFTQyxFQUFRQSxFQUFPRCxRQUFTSCxHQUdwRUksRUFBT0QsT0FDZixDLE1DdEJBLGFBQ0EsU0FDQSxTQUNBLFNBR0EsU0FDQSxTQVFNSSxFQUFjMUcsU0FBU1EsZUFBZSxTQUN6QixPQUFoQmtHLEVBQXNCQSxFQUFZL0UsaUJBQWlCLFFBQVMsRUFBQWhCLFlBQzFEakMsTUFBTSxnREFFWCxJQUFNaUksRUFBZ0IzRyxTQUFTUSxlQUFlLFNBQ3pCLE9BQWxCbUcsRUFBd0JBLEVBQWNoRixpQkFBaUIsUUFBUyxFQUFBckQsV0FDOURJLE1BQU0sNkNBRVhrSSxPQUFPakYsaUJBQWlCLFdBQVcsU0FBU2tGLEdBQzFCLE1BQVZBLEVBQUVDLE1BQTZCLElBQWRELEVBQUVFLFVBQ25CRixFQUFFRyxrQkFFRixJQUFBM0QsWUFFUixJQUVBLElBQU00RCxFQUFhakgsU0FBU1EsZUFBZSxRQUN6QixPQUFmeUcsRUFDQ0EsRUFBV3RGLGlCQUFpQixRQUFTLEVBQUEwQixVQUNsQzNFLE1BQU0sNENBRWIsSUFBTXdJLEVBQWNsSCxTQUFTUSxlQUFlLFNBQ3pCLE9BQWhCMEcsUUFBd0M1RCxJQUFoQjRELEVBQ3ZCQSxFQUFZdkYsaUJBQWlCLFFBQVMsRUFBQXFFLFdBQ25DdEgsTUFBTSw2Q0FPYixJQUFBa0MsYUFBWXVHLEVBQVV4RCxnQiIsInNvdXJjZXMiOlsid2VicGFjazovL3N1ZG9rdXdlYnBhY2svLi9zcmMvQ2hlY2tpbmdHcmlkL2NoZWNraW5nR3JpZC50cyIsIndlYnBhY2s6Ly9zdWRva3V3ZWJwYWNrLy4vc3JjL0dldHRlci9nZXRHcmlkLnRzIiwid2VicGFjazovL3N1ZG9rdXdlYnBhY2svLi9zcmMvTWFuYWdpbmdHcmlkL2NsZWFyLnRzIiwid2VicGFjazovL3N1ZG9rdXdlYnBhY2svLi9zcmMvTWFuYWdpbmdHcmlkL2NyZWF0ZS50cyIsIndlYnBhY2s6Ly9zdWRva3V3ZWJwYWNrLy4vc3JjL01hbmFnaW5nR3JpZC91bmRvLnRzIiwid2VicGFjazovL3N1ZG9rdXdlYnBhY2svLi9zcmMvUmVwb3NpdG9yeS9UZXN0aW5nR3JpZHMvdGVzdFNvbHZpbmcudHMiLCJ3ZWJwYWNrOi8vc3Vkb2t1d2VicGFjay8uL3NyYy9zb2x2ZUdyaWQvQ2VsbC50cyIsIndlYnBhY2s6Ly9zdWRva3V3ZWJwYWNrLy4vc3JjL3NvbHZlR3JpZC9maW5kTWlzc2luZ051bWJlcnMudHMiLCJ3ZWJwYWNrOi8vc3Vkb2t1d2VicGFjay8uL3NyYy9zb2x2ZUdyaWQvaGlkZGVuU2luZ2xlLnRzIiwid2VicGFjazovL3N1ZG9rdXdlYnBhY2svLi9zcmMvc29sdmVHcmlkL25ha2VkU2luZ2xlLnRzIiwid2VicGFjazovL3N1ZG9rdXdlYnBhY2svLi9zcmMvc29sdmVHcmlkL3NvbHZlLnRzIiwid2VicGFjazovL3N1ZG9rdXdlYnBhY2svd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vc3Vkb2t1d2VicGFjay8uL3NyYy9pbmRleC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBnZXRDdXJyZW50R3JpZCB9IGZyb20gXCIuLi9HZXR0ZXIvZ2V0R3JpZFwiO1xuXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLWNoZWNraW5nIHRoZSBHcmlkLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gZnVuY3Rpb25zIGZvciB0aGUgY2hlY2sgQnV0dG9uXG5cbi8qKlxuICogdGhlIG1haW4gY2hlY2tpbmcgZnVuY3Rpb24gdGhhdCB3aWxsIHVzZSBhbGwgb3RoZXIgZnVuY3Rpb24gaW4gdGhpcyBmaWxlIChhbmQgZ2V0dGluZyB0aGUgY3VycmVudCBncmlkKVxuICovXG5jb25zdCBjaGVja0dyaWQgPSAoKTogc3RyaW5nID0+IHtcbiAgICBsZXQgb3V0cHV0OiBzdHJpbmc7XG4gICAgY29uc3QgZyA9IGdldEN1cnJlbnRHcmlkKCk7XG4gICAgaWYgKGcgPT09IG51bGwgfHwgZyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIG91dHB1dCA9IGBzb21ldGhpbmcgd2VudCB3cm9uZyB3aXRoIGZldGNoaW5nIHRoZSBncmlkIDpTYDtcbiAgICAgICAgYWxlcnQob3V0cHV0KTtcbiAgICAgICAgcmV0dXJuIG91dHB1dDtcbiAgICB9ZWxzZSBpZiAoZ3JpZElzRnVsbCgpICE9PSB0cnVlKSB7XG4gICAgICAgIG91dHB1dCA9IGB0aGUgZ3JpZCBpcyBub3QgZnVsbHkgZmlsbGVkIDpTYDtcbiAgICAgICAgYWxlcnQob3V0cHV0KTtcbiAgICAgICAgcmV0dXJuIG91dHB1dDtcbiAgICB9ZWxzZSBpZiAoY2hlY2tSb3dzQW5kQ29sdW1ucygpICE9PSB0cnVlICYmIGNoZWNrQm94ZXMoKSAhPT0gdHJ1ZSkge1xuICAgICAgICBvdXRwdXQgPSBgdGhlIGdyaWQgaXMgaW5jb3JyZWN0IDpTYDtcbiAgICAgICAgYWxlcnQob3V0cHV0KTtcbiAgICAgICAgcmV0dXJuIG91dHB1dDtcbiAgICB9ZWxzZSB7XG4gICAgICAgIG91dHB1dCA9IGB0aGUgZ3JpZCBpcyBjb3JyZWN0IDpELiBXZWxsIGRvbmUhYDtcbiAgICAgICAgYWxlcnQob3V0cHV0ICk7XG4gICAgICAgIHJldHVybiBvdXRwdXRcbiAgICB9O1xufVxuXG5jb25zdCBncmlkSXNGdWxsID0gKCk6IGJvb2xlYW4gICA9PiB7XG4gICAgY29uc3QgZyA9IGdldEN1cnJlbnRHcmlkKCk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCA5OyBpKyspIHtcbiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCA5OyBqKyspIHtcbiAgICAgICAgICAgIGlmIChnW2ldW2pdID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG59XG5cbi8qKlxuICogYSBsb3Qgb2YgdHJvdWJsZSB3aXRoIHRoaXMgb25lLiBTZXQgdGhlIGNvdW50ZXIgQXJyYXkgdG8gYWxsIDBzIGFmdGVyIGVhY2ggcm93L2NvbHVtbjtcbiAqIC0tPiBjb3VudGluZyB0aGUgb2NjdXJyZW5jZSBvZiBudW1iZXJzIGluIGVhY2ggcm93L2NvbHVtbiwgY2hlY2tpbmcgaWYgaXQgaXMgZXF1YWwgdG8gMVxuICogQHJldHVybnMgYm9vbGVhbiB0aGF0IGluZGljYXRlcyB3aGV0aGVyIHRoZSBzdWRva3UgZ3JpZCdzIHJvd3MgYW5kIGNvbHVtbnMgYXJlIGNvcnJlY3QgXG4gKiBhcyBwZXIgc3Vkb2t1IHJ1bGVzXG4gKi9cbmNvbnN0IGNoZWNrUm93c0FuZENvbHVtbnMgPSAoKTogYm9vbGVhbiA9PiB7XG4gICAgY29uc3QgY3VycmVudEdyaWQgPSBnZXRDdXJyZW50R3JpZCgpO1xuICAgIGxldCBjb3VudGVyUm93cyA9IG5ldyBBcnJheSg5KS5maWxsKDApO1xuICAgIGxldCBjb3VudGVyQ29sdW1ucyA9IG5ldyBBcnJheSg5KS5maWxsKDApO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgOTsgaSsrKSB7XG4gICAgICAgIGNvdW50ZXJSb3dzLmZpbGwoMCk7IFxuICAgICAgICBjb3VudGVyQ29sdW1ucy5maWxsKDApO1xuICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDk7IGorKykge1xuICAgICAgICAgICAgY29uc3QgbnVtUm93ID0gY3VycmVudEdyaWRbaV1bal07XG4gICAgICAgICAgICBjb25zdCBudW1Db2wgPSBjdXJyZW50R3JpZFtqXVtpXTtcbiAgICAgICAgICAgIGNvdW50ZXJSb3dzW251bVJvdy0xXSsrO1xuICAgICAgICAgICAgY291bnRlckNvbHVtbnNbbnVtQ29sLTFdKys7XG4gICAgICAgICAgICBpZihjb3VudGVyUm93c1tudW1Sb3ctMV0gIT0gMSkgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgaWYoY291bnRlckNvbHVtbnNbbnVtQ29sLTFdICE9IDEpIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICAvLyBpZiBldmVuIG9uZSBlbGVtIG9mIHRoZSBjb3VudEFycmF5cyBpcyBub3QgZXF1YWwgMSBmYWxzZSB3aWxsIGJlIHJldHVybmVkXG4gICAgICAgIC8vIGlmKGNvdW50ZXJSb3dzLnNvbWUoY291bnQgPT4gY291bnQgIT09IDkpKSByZXR1cm4gZmFsc2U7XG4gICAgICAgIC8vIGVsc2UgaWYoY291bnRlckNvbHVtbnMuc29tZShjb3VudCA9PiBjb3VudCAhPT0gOSkpIHJldHVybiBmYWxzZTtcbiAgICAgICAgLy8gZG9lc24ndCB3b3JrIGZvciB0aGUgaW5jb3JyZWN0IG9yZGVyIG9mIG51bWJlcnMgaW4gdGhlIGdyaWRcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG59XG5cblxuLy8gYSBsaXR0bGUgdW5wbGVhc2FudCwgYnV0IGFzIG9mIHJpZ2h0IG5vdyBJIGRvbid0IGtub3cgd2hhdCBlbHNlIHRvIGRvIDovXG4vLyBATWUgc3VyZWx5IGl0IGNhbiBiZSBzb2x2ZWQgbW9yZSBlbGVnYW50bHkgYnV0IFwiZG9uJ3QgY2hhbmdlIGEgcnVubmluZyBzeXN0ZW1cIiA6RCBcbmNvbnN0IGNoZWNrQm94ZXMgPSAoKTogYm9vbGVhbiA9PiB7XG4gICAgLy8gZmlyc3Qgcm93IG9mIGJveGVzOlxuICAgIGlmIChib3hDaGVja0hlbHBlcigwLCAyLCAwLCAyKSAhPSB0cnVlKSByZXR1cm4gZmFsc2U7XG4gICAgZWxzZSBpZiAoYm94Q2hlY2tIZWxwZXIoMCwgMiwgMywgNSkgIT0gdHJ1ZSkgcmV0dXJuIGZhbHNlO1xuICAgIGVsc2UgaWYgKGJveENoZWNrSGVscGVyKDAsIDIsIDYsIDgpICE9IHRydWUpIHJldHVybiBmYWxzZTtcbiAgICAvLyBzZWNvbmQgcm93IG9mIGJveGVzOlxuICAgIGVsc2UgaWYgKGJveENoZWNrSGVscGVyKDMsIDUsIDAsIDIpICE9IHRydWUpIHJldHVybiBmYWxzZTtcbiAgICBlbHNlIGlmIChib3hDaGVja0hlbHBlcigzLCA1LCA2LCA4KSAhPSB0cnVlKSByZXR1cm4gZmFsc2U7XG4gICAgZWxzZSBpZiAoYm94Q2hlY2tIZWxwZXIoMywgNSwgMCwgMikgIT0gdHJ1ZSkgcmV0dXJuIGZhbHNlO1xuICAgIC8vIHRoaXJkIHJvdyBvZiBib3hlczpcbiAgICBlbHNlIGlmIChib3hDaGVja0hlbHBlcig1LCA4LCAwLCAyKSAhPSB0cnVlKSByZXR1cm4gZmFsc2U7XG4gICAgZWxzZSBpZiAoYm94Q2hlY2tIZWxwZXIoNSwgOCwgMywgNSkgIT0gdHJ1ZSkgcmV0dXJuIGZhbHNlO1xuICAgIGVsc2UgaWYgKGJveENoZWNrSGVscGVyKDUsIDgsIDUsIDgpICE9IHRydWUpIHJldHVybiBmYWxzZTtcbiAgICBlbHNlIHJldHVybiB0cnVlXG59XG5cbmNvbnN0IGJveENoZWNrSGVscGVyID0gKGZyb21Sb3c6IG51bWJlciwgdG9Sb3c6IG51bWJlciwgZnJvbUNvbHVtbjogbnVtYmVyLCB0b0NvbHVtbjogbnVtYmVyKTogYm9vbGVhbiA9PiB7XG4gICAgY29uc3QgZyA9IGdldEN1cnJlbnRHcmlkKCk7XG4gICAgbGV0IGNvdW50ZXIgPSBuZXcgQXJyYXkoOSkuZmlsbCgwKTtcbiAgICAvLyBpZiAoZnJvbVJvdyA9PSBudWxsIHx8IGZyb21Sb3cgPT0gdW5kZWZpbmVkIHx8IHRvUm93ID09IG51bGwgfHwgdG9Sb3cgPT0gdW5kZWZpbmVkXG4gICAgLy8gICAgIHx8IGZyb21Db2x1bW4gPT0gbnVsbCB8fCBmcm9tQ29sdW1uID09IHVuZGVmaW5lZCB8fCB0b0NvbHVtbiA9PSBudWxsIHx8IHRvQ29sdW1uID09IHVuZGVmaW5lZCkgcmV0dXJuIGZhbHNlO1xuICAgIGZvciAobGV0IGkgPSBmcm9tUm93OyBpIDw9IHRvUm93OyBpKyspIHtcbiAgICAgICAgZm9yIChsZXQgaiA9IGZyb21Db2x1bW47IGogPD0gdG9Db2x1bW47IGorKykge1xuICAgICAgICAgICAgY29uc3QgbnVtID0gZ1tpXVtqXTtcbiAgICAgICAgICAgIGNvdW50ZXJbbnVtLTFdKys7XG4gICAgICAgICAgICBpZiAoY291bnRlcltudW0tMV0gPiAxKSByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG59XG5cbmV4cG9ydCB7IGNoZWNrR3JpZCwgY2hlY2tSb3dzQW5kQ29sdW1ucyB9IiwiXG4vLyBnZXR0aW5nIHRoZSBjdXJyZW50IEdyaWQgb3V0IG9mIERPTVxuY29uc3QgZ2V0Q3VycmVudEdyaWQgPSAoKTogbnVtYmVyW11bXSA9PiB7XG4gICAgbGV0IGdyaWQ6IG51bWJlcltdW10gPSBbXTtcbiAgICBmb3IobGV0IGkgPSAwOyBpIDwgOTsgaSsrKSB7XG4gICAgICAgIGdyaWRbaV0gPSBuZXcgQXJyYXkoOSkuZmlsbChudWxsKTtcbiAgICB9XG4gICAgY29uc3QgY2VsbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY2VsbCcpO1xuICAgIGlmKGNlbGxzID09PSBudWxsIHx8IGNlbGxzID09PSB1bmRlZmluZWQpIHJldHVybiBudWxsO1xuICAgIGZvcihsZXQgaSA9IDA7IGkgPD0gODsgaSsrKSB7XG4gICAgICAgIGZvcihsZXQgaiA9IDA7IGogPD0gODsgaisrKSB7XG4gICAgICAgICAgICBjb25zdCB0ZW1wID0gY2VsbHNbaSo5K2pdOyAvLyBtYXBwcyB0aGUgODEgY2VsbHMgdG8gdGhlIDIgZGltIGFycmF5XG4gICAgICAgICAgICBpZighKHRlbXAgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCkpIHJldHVybiBudWxsO1xuICAgICAgICAgICAgaWYoIXRlbXApIHJldHVybiBudWxsOyAvLyBjaGVja2luZyBpZiB0ZW1wIGlzIGZhbHN5XG4gICAgICAgICAgICBjb25zdCB0ZW1wTnVtID0gdGVtcC5pbm5lclRleHQ7XG4gICAgICAgICAgICBncmlkW2ldW2pdID0gTnVtYmVyKHRlbXBOdW0pOyAvLyByZXR1cm4gJzAnIHdoZW4gJ3RlbXBOdW0gPSBudWxsJyFcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZ3JpZDtcbn1cblxuZXhwb3J0IHsgZ2V0Q3VycmVudEdyaWQgfSIsImltcG9ydCB7IGNyZWF0ZUJvYXJkIH0gZnJvbSBcIi4vY3JlYXRlXCI7XG5cbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tY2xlYXJpbmcgdGhlIEdyaWQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbmNvbnN0IGNyZWF0ZVZvaWRHcmlkID0gKCk6IG51bWJlcltdW10gPT4ge1xuICAgIGxldCBncmlkOiBudW1iZXJbXVtdID0gW107XG4gICAgZm9yKGxldCBpID0gMDsgaSA8IDk7IGkrKykge1xuICAgICAgICBncmlkW2ldID0gbmV3IEFycmF5KDkpLmZpbGwobnVsbCk7XG4gICAgfVxuICAgIHJldHVybiBncmlkO1xufVxuXG5jb25zdCBkZWxldGVCb2FyZCA9ICgpOiB2b2lkID0+IHtcbiAgICBjb25zdCBncmlkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGdyaWRgKTtcbiAgICBpZihncmlkID09PSBudWxsKSByZXR1cm47XG4gICAgd2hpbGUoZ3JpZC5sYXN0Q2hpbGQpIHtcbiAgICAgICAgZ3JpZC5yZW1vdmVDaGlsZChncmlkLmxhc3RDaGlsZCk7XG4gICAgfVxufVxuXG5jb25zdCBjbGVhckJvYXJkID0gKCk6IHZvaWQgPT4ge1xuICAgIGRlbGV0ZUJvYXJkKCk7XG4gICAgY3JlYXRlQm9hcmQoY3JlYXRlVm9pZEdyaWQoKSk7XG59XG5cbmV4cG9ydCB7IGNsZWFyQm9hcmQsIGRlbGV0ZUJvYXJkIH0iLCJpbXBvcnQgeyB1bmRvU3RhY2sgfSBmcm9tIFwiLi91bmRvXCI7XG5cbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tY3JlYXRpbmcgR3JpZC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbi8vIGNyZWF0aW5nIEdyaWQgd2l0aCBldmVudExpc3RlbmVyIGlucHV0dGluZyBjZWxsc1xuLy8gYSBmdW5jdGlvbiBjcmVhdGluZyBhIDl4OSBncmlkIG9mIHNxdWFyZXNcbmNvbnN0IGNyZWF0ZUJvYXJkID0gKHdpdGhHcmlkOiBudW1iZXJbXVtdKTogdm9pZCA9PiB7XG4gICAgY29uc3QgZ3JpZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZ3JpZFwiKTtcbiAgICBpZihncmlkID09PSBudWxsIHx8IGdyaWQgPT09IHVuZGVmaW5lZCkgcmV0dXJuO1xuXG4gICAgLy8gY3JlYXRlIDkgcm93cyBmb3IgdGhlIHN1ZG9rdSBncmlkXG4gICAgd2l0aEdyaWQuZm9yRWFjaCgoZWxlbTogbnVtYmVyW10sIHJvd0luZGV4OiBudW1iZXIpID0+IHtcbiAgICAgICAgY29uc3Qgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIGlmKHJvdyA9PT0gbnVsbCkgcmV0dXJuO1xuICAgICAgICByb3cuY2xhc3NMaXN0LmFkZCgncm93Jyk7XG4gICAgICAgIHJvdy5zZXRBdHRyaWJ1dGUoXCJyb3dcIiwgYCR7cm93SW5kZXh9YCk7XG4gICAgICAgIGlmIChyb3dJbmRleCA9PT0gMiB8fCByb3dJbmRleCA9PT0gNSkgcm93LmNsYXNzTGlzdC5hZGQoJ3VuZGVybGluZScpO1xuICAgICAgICBncmlkLmFwcGVuZChyb3cpO1xuXG4gICAgICAgIC8vIGluc2VydCBjZWxscyBpbnRvIGVhY2ggcm93XG4gICAgICAgIGVsZW0uZm9yRWFjaCgodmFsdWU6IG51bWJlciwgY29sSW5kZXg6IG51bWJlcikgPT4ge1xuICAgICAgICAgICAgY29uc3QgY2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgICAgICBpZihjZWxsID09PSBudWxsKSByZXR1cm47XG4gICAgICAgICAgICBjZWxsLnNldEF0dHJpYnV0ZShcInJvd1wiLCBgJHtyb3dJbmRleH1gKVxuICAgICAgICAgICAgY2VsbC5zZXRBdHRyaWJ1dGUoXCJjb2x1bW5cIiwgYCR7Y29sSW5kZXh9YClcbiAgICAgICAgICAgIGNlbGwuY2xhc3NMaXN0LmFkZChcImNlbGxcIik7XG4gICAgICAgICAgICBpZiAoY29sSW5kZXggPT0gMiB8fCBjb2xJbmRleCA9PSA1KSBjZWxsLmNsYXNzTGlzdC5hZGQoJ3JpZ2h0bGluZScpO1xuXG4gICAgICAgICAgICAvLyBjb25zdCBjZWxsTnVtYmVyID0gTnVtYmVyLnBhcnNlSW50KHZhbHVlLnRvU3RyaW5nKCkpO1xuICAgICAgICAgICAgaWYodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IDApIHtcbiAgICAgICAgICAgICAgICBjZWxsLnNldEF0dHJpYnV0ZShcInR5cGVcIiwgXCJidXR0b25cIik7XG4gICAgICAgICAgICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYWRkTnVtYmVyKTtcbiAgICAgICAgICAgIH0gZWxzZSBjZWxsLmlubmVyVGV4dCA9IHZhbHVlLnRvU3RyaW5nKCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHJvdy5hcHBlbmQoY2VsbCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufVxuXG5jb25zdCBhZGROdW1iZXIgPSAoZXZlbnQ6IE1vdXNlRXZlbnQpOiB2b2lkID0+IHtcbiAgICBjb25zdCBlbGVtID0gZXZlbnQudGFyZ2V0O1xuICAgIGlmICghKGVsZW0gaW5zdGFuY2VvZiBIVE1MRWxlbWVudCkpIHJldHVybjtcbiAgICBjb25zdCByb3cgPSBlbGVtLmdldEF0dHJpYnV0ZShcInJvd1wiKTtcbiAgICBjb25zdCBjb2x1bW4gPSBlbGVtLmdldEF0dHJpYnV0ZShcImNvbHVtblwiKTtcbiAgICBjb25zdCBjZWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgW3Jvdz1cIiR7cm93fVwiXVtjb2x1bW49XCIke2NvbHVtbn1cIl1gKTtcbiAgICBpZighKGNlbGwgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCkpIHJldHVybjtcbiAgICBsZXQgbnVtOiBudW1iZXI7XG4gICAgZG8ge1xuICAgICAgICBjb25zdCBwcm9tdCA9IHByb21wdChcIkVudGVyIGEgbnVtYmVyIGJldHdlZW4gMSBhbmQgOTpcIik7XG4gICAgICAgIGlmKHByb210ID09PSBudWxsKSByZXR1cm47XG4gICAgICAgIG51bSA9IE51bWJlci5wYXJzZUludChwcm9tdCk7XG4gICAgfSB3aGlsZSAoaXNOYU4oTnVtYmVyKG51bSkpKVxuICAgIGlmICghaXNOYU4oTnVtYmVyKG51bSkpICYmIGNlbGwgIT09IG51bGwpIHtcbiAgICAgICAgbGV0IG51bWJlckJlZm9yZUNoYW5nZTogbnVtYmVyO1xuICAgICAgICBpZihjZWxsLmlubmVySFRNTCA9PT0gYGApIG51bWJlckJlZm9yZUNoYW5nZSA9IDA7XG4gICAgICAgIGVsc2UgbnVtYmVyQmVmb3JlQ2hhbmdlID0gTnVtYmVyLnBhcnNlSW50KGNlbGwuaW5uZXJIVE1MKTtcbiAgICAgICAgY2VsbC5pbm5lclRleHQgPSBudW0udG9TdHJpbmcoKTtcbiAgICAgICAgdW5kb1N0YWNrLnB1c2goW051bWJlci5wYXJzZUludChyb3cpLCBOdW1iZXIucGFyc2VJbnQoY29sdW1uKSwgbnVtYmVyQmVmb3JlQ2hhbmdlXSlcbiAgICB9XG59XG5cbmV4cG9ydCB7IGNyZWF0ZUJvYXJkIH0iLCIvKipcbiAqIHVuZG8gaXMgaW1wbGVtZW50ZWQgYnkgYSBzdGFjayB0aGF0IHdpbGwgYmUgcHVzaGVkIChLb29yZGluYXRlcywgTnVtYmVyKSBcbiAqIHdoZW4gYSBudW1iZXIgZ2V0cyBhZGRlZCB0byB0aGUgZ3JpZFxuICogdGhlIHN0YWNrIHdpbGwgYmUgcG9wcGVkIHdoZW46IHRoZSB1bmRvIGJ1dHRvbiBpcyBwcmVzc2VkXG4gKiAtLT4gdGhlIHN0YWNrIG11c3QgYmUgZ2xvYmFsIG9mIHNvbWUga2luZFxuICovXG5cbmludGVyZmFjZSBJU3RhY2s8VD4ge1xuICAgIHB1c2goaXRlbTogVCk6IHZvaWQ7XG4gICAgcG9wKCk6IFQgfCB1bmRlZmluZWQ7XG4gICAgcGVlaygpOiBUIHwgdW5kZWZpbmVkO1xuICAgIHNpemUoKTogVCB8IG51bWJlcjtcbn1cblxuYWJzdHJhY3QgY2xhc3MgQ29sbGVjdGlvbjxUPiB7XG4gICAgcHJvdGVjdGVkIHN0b3JhZ2U6IFRbXSA9IFtdO1xuICBcbiAgICBzaXplKCk6IG51bWJlciB7XG4gICAgICByZXR1cm4gdGhpcy5zdG9yYWdlLmxlbmd0aDtcbiAgICB9XG4gICAgYWJzdHJhY3QgaXNGdWxsKCk6IGJvb2xlYW47XG4gIH1cblxuICBjbGFzcyBTdGFja0NvbGxlY3Rpb248VD4gZXh0ZW5kcyBDb2xsZWN0aW9uPFQ+IGltcGxlbWVudHMgSVN0YWNrPFQ+IHtcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGNhcGFjaXR5OiBudW1iZXIgPSBJbmZpbml0eSkge1xuICAgICAgc3VwZXIoKTtcbiAgICB9XG4gIFxuICAgIHB1c2goaXRlbTogVCkge1xuICAgICAgaWYgKHRoaXMuaXNGdWxsKCkpIHtcbiAgICAgICAgdGhyb3cgRXJyb3IoXCJTdGFjayBoYXMgcmVhY2hlZCBtYXggY2FwYWNpdHksIHlvdSBjYW5ub3QgYWRkIG1vcmUgaXRlbXNcIik7XG4gICAgICB9XG4gICAgICAvLyBJbiB0aGUgZGVyaXZlZCBjbGFzcywgd2UgY2FuIGFjY2VzcyBwcm90ZWN0ZWQgcHJvcGVydGllcyBvZiB0aGUgYWJzdHJhY3QgY2xhc3NcbiAgICAgIHRoaXMuc3RvcmFnZS5wdXNoKGl0ZW0pO1xuICAgIH1cbiAgXG4gICAgcG9wKCk6IFQgfCB1bmRlZmluZWQge1xuICAgICAgcmV0dXJuIHRoaXMuc3RvcmFnZS5wb3AoKTtcbiAgICB9XG4gIFxuICAgIHBlZWsoKTogVCB8IHVuZGVmaW5lZCB7XG4gICAgICByZXR1cm4gdGhpcy5zdG9yYWdlW3RoaXMuc2l6ZSgpIC0gMV07XG4gICAgfVxuICBcbiAgICAvLyBJbXBsZW1lbnRhdGlvbiBvZiB0aGUgYWJzdHJhY3QgbWV0aG9kXG4gICAgaXNGdWxsKCk6IGJvb2xlYW4ge1xuICAgICAgcmV0dXJuIHRoaXMuY2FwYWNpdHkgPT09IHRoaXMuc2l6ZSgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBhIFN0YWNrIENvbGxlY3Rpb24gZmlsbGVkIHdpdGggYSAyIGRpbSBudW1iZXIgQXJyYXk6XG4gICAqIGUuZzogaW4gdGhlIGdyaWQgdGhlIGNlbGwgaW4gcm93IDMsIGNvbHVtbiA1IGdldHMgdXBkYXRlZCB0byA3OlxuICAgKiBzdGFja0ZvclVuZG8ucHVzaChbMyw1LDBdKSAtLT4gaW4gdGhlIGNyZWF0aW5nR3JpZC5hZGROdW1iZXIoKVxuICAgKiAwIHNheXMgaW4gdGhpcyBjYXNlLCB0aGF0IG9uZSBzdGVwIGJlZm9yZSB0aGUgY2VsbCB3YXMgbm90IGZpbGxlZFxuICAgKiBJZiB0aGUgdW5kbyBidXR0b24gaXMgcHJlc3NlZCB0aGUgaW5uZXJUZXh0IGh0bWwgb2YgdGhlIGNlbGwgaW4gcm93IDMsIGNvbHVtbiA1IHdpbGwgYmUgc2V0IHRvIHplcm8uXG4gICAqIC4uLmFuZDogc3RhY2tGb3JVbmRvLnBvcCgpIC0tPiBpbiB0aGUgY3JlYXRpbmdHcmlkLmFkZE51bWJlcigpXG4gICAqL1xuICBjb25zdCB1bmRvU3RhY2sgPSBuZXcgU3RhY2tDb2xsZWN0aW9uPG51bWJlcltdPigpO1xuXG4gIGNvbnN0IHVuZG9TdGVwID0gKCk6IHN0cmluZyA9PiB7XG4gICAgaWYodW5kb1N0YWNrLnBlZWsoKSA9PT0gbnVsbCB8fCB1bmRvU3RhY2sucGVlaygpID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgY29uc3Qgc3RyID0gYHVuZG9TdGFjayBpcyBudWxsIG9yIHVuZGVmaW5lZGA7XG4gICAgICAgIGFsZXJ0KHN0cik7XG4gICAgICAgIHJldHVybiBzdHI7XG4gICAgfSBlbHNlIGlmKHVuZG9TdGFjay5zaXplKCkgPT09IDApIHtcbiAgICAgICAgY29uc3Qgc3RyID0gYHRoZSB1bmRvU3RhY2sgaXMgbm90IHlldCBidWlsdGA7XG4gICAgICAgIGFsZXJ0KHN0cik7XG4gICAgICAgIHJldHVybiBzdHI7XG4gICAgfVxuICAgIGNvbnN0IGFyciA9IHVuZG9TdGFjay5wb3AoKTtcbiAgICBpZihhcnIubGVuZ3RoICE9PSAzKSB7XG4gICAgICAgIGNvbnN0IHN0ciA9IGBzb21ldGhpbmcgd2VudCB3cm9uZyB3aXRoIGZldGNoaW5nIGFuIHVuZG9TdGFjay1lbGVtZW50YDtcbiAgICAgICAgYWxlcnQoc3RyKTtcbiAgICAgICAgcmV0dXJuIHN0cjtcbiAgICB9XG4gICAgY29uc3QgY2VsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYFtyb3c9XCIke2FyclswXX1cIl1bY29sdW1uPVwiJHthcnJbMV19XCJdYCk7XG4gICAgY29uc29sZS5sb2coYHVuZGlkIHJvdyAke2FyclswXSsxfSBjb2x1bW4gJHthcnJbMV0rMX0gZnJvbSAke2NlbGwuaW5uZXJIVE1MfSB0byAke2FyclsyXX1gKTtcbiAgICBpZihhcnJbMl0gPT09IDApIGNlbGwuaW5uZXJIVE1MID0gYGA7XG4gICAgZWxzZSBjZWxsLmlubmVySFRNTCA9IGFyclsyXS50b1N0cmluZygpO1xuICAgIHJldHVybiBgZ29vZCB3b3JrIG1hdGVgO1xuICB9XG5cblxuZXhwb3J0eyB1bmRvU3RhY2ssIHVuZG9TdGVwIH0iLCJjb25zdCB0ZXN0TmFrZWRTaW5nbGU6IG51bWJlcltdW10gPSBbXG4gICAgWzAsMSwwLDAsMCwwLDAsMCwwXSxcbiAgICBbMCwwLDAsMCwxLDAsMCwwLDBdLFxuICAgIFswLDAsMCwwLDAsMCwwLDAsMF0sXG4gICAgWzAsMCwwLDAsMCwwLDEsMCwwXSxcbiAgICBbMCwwLDAsMCwwLDAsMCwwLDBdLFxuICAgIFswLDAsMCwwLDAsMCwwLDAsMF0sXG4gICAgWzAsMCwwLDAsMCwwLDAsMSwwXSxcbiAgICBbMCwwLDAsMCwwLDAsMCwwLDBdLFxuICAgIFswLDAsMCwwLDAsMCwwLDAsMF1cbl1cblxuZXhwb3J0IHtcbiAgICB0ZXN0TmFrZWRTaW5nbGVcbn0iLCJjbGFzcyBDZWxsIHtcblx0cHJpdmF0ZSByb3c6IG51bWJlcjtcblx0cHJpdmF0ZSBjb2x1bW46IG51bWJlcjtcblx0cHJpdmF0ZSBib3g6IG51bWJlcjtcblx0cHJpdmF0ZSBwb3NzaWJsZVZhbHVlczogbnVtYmVyW107XG5cblx0Y29uc3RydWN0b3Iocm93OiBudW1iZXIgPSBudWxsLCBjb2x1bW46IG51bWJlciA9IG51bGwsIHBvc3NpYmxlc1ZhbHVlczogbnVtYmVyW10gPSBudWxsKSB7XG5cdFx0dGhpcy5yb3cgPSByb3c7XG5cdFx0dGhpcy5jb2x1bW4gPSBjb2x1bW47XG5cdFx0Ly8gYm94TnVtYmVyID0gYm94Um93ICogMyArIGJveENvbHVtblxuXHRcdGlmKHJvdyA9PT0gbnVsbCB8fCBjb2x1bW4gPT09IG51bGwpIHRoaXMuYm94ID0gbnVsbDtcblx0XHRlbHNlIHRoaXMuYm94ID0gTWF0aC5mbG9vcih0aGlzLnJvdyAvIDMpICogMyArIE1hdGguZmxvb3IodGhpcy5jb2x1bW4gLyAzKTtcblx0XHR0aGlzLnBvc3NpYmxlVmFsdWVzID0gcG9zc2libGVzVmFsdWVzO1xuXHR9XG5cblxuXHRwdWJsaWMgZ2V0Um93KCkgeyByZXR1cm4gdGhpcy5yb3cgfVxuXHRwdWJsaWMgZ2V0Q29sdW1uKCkgeyByZXR1cm4gdGhpcy5jb2x1bW4gfVxuXHRwdWJsaWMgZ2V0Qm94KCkgeyByZXR1cm4gdGhpcy5ib3ggfVxuXHRwdWJsaWMgZ2V0UG9zc2libGVWYWx1ZXMoKTogbnVtYmVyW10geyByZXR1cm4gdGhpcy5wb3NzaWJsZVZhbHVlcyB9XG5cdHB1YmxpYyBzZXRQb3NzaWJsZVZhbHVlcyhwb3NzaWJsZXNWYWx1ZXM6IG51bWJlcltdKSB7IHRoaXMucG9zc2libGVWYWx1ZXMgPSBwb3NzaWJsZXNWYWx1ZXMgfVxuXG5cdHB1YmxpYyBjbG9uZSgpOiBDZWxsIHtcblx0XHRjb25zdCBjb3BpZWRDZWxsID0gbmV3IENlbGwodGhpcy5yb3csIHRoaXMuY29sdW1uLCBbLi4udGhpcy5wb3NzaWJsZVZhbHVlc10pO1xuXHRcdHJldHVybiBjb3BpZWRDZWxsO1xuXHQgIH1cbn1cblxuZXhwb3J0IHsgQ2VsbCB9XG4iLCJpbXBvcnQgeyBhcHBseVBvaW50aW5nUGFpcnMgfSBmcm9tIFwiLi9wb2ludGluZ1BhaXJcIjtcbmltcG9ydCB7IGFwcGx5SGlkZGVuU2luZ2xlIH0gZnJvbSBcIi4vaGlkZGVuU2luZ2xlXCI7XG5pbXBvcnQgeyBhcHBseU5ha2VkU2luZ2xlIH0gZnJvbSBcIi4vbmFrZWRTaW5nbGVcIjtcbmltcG9ydCB7IENlbGwgfSBmcm9tIFwiLi9DZWxsXCI7XG5cblxuXG4vLyBIZWxwZXIgZnVuY3Rpb24gdG8gY29tcGFyZSB0d28gYXJyYXlzIGZvciBlcXVhbGl0eVxuY29uc3QgYXJyYXlzRXF1YWwgPSAoYTogYW55W10sIGI6IGFueVtdKTogYm9vbGVhbiA9PiB7XG5cdGlmIChhID09PSBiKSByZXR1cm4gdHJ1ZTtcblx0aWYgKGEgPT0gbnVsbCB8fCBiID09IG51bGwpIHJldHVybiBmYWxzZTtcblx0aWYgKGEubGVuZ3RoICE9PSBiLmxlbmd0aCkgcmV0dXJuIGZhbHNlO1xuXG5cdGZvciAobGV0IGkgPSAwOyBpIDwgYS5sZW5ndGg7IGkrKykge1xuXHRcdGlmIChhW2ldICE9PSBiW2ldKSByZXR1cm4gZmFsc2U7XG5cdH1cblxuXHRyZXR1cm4gdHJ1ZTtcbn1cblxuLyoqXG4gKiBpcyBjYWxsZWQgYnkgLi4vTWFuYWdpbmdHcmlkL3NvbHZlLnRzXG4gKiBvbmx5IGltcGxlbWVudHMgYWxnb3JpdGhtICh0aGluZ3MgcmVsYXRlZCB0byB0aGUgZ3JpZCBpbiB0aGUgY2xpZW50IEhUTUwgYXJlIG1hbmFnZWQgYnkgJ3NvbHZlLnRzJylcbiAqIEBwYXJhbSBncmlkIFxuICogQHJldHVybnMgbnVtYmVyW11bXVxuICovXG5jb25zdCBmaW5kTnVtYmVycyA9IChncmlkOiBudW1iZXJbXVtdKTogbnVtYmVyW11bXSA9PiB7XG5cdGxldCBhbGxGcmVlQ2VsbHM6IENlbGxbXSA9IGZpbmRFbXB0eUNlbGxzKGdyaWQpOyAvLyByZXR1cm5zIGFuIGFycmF5IG9mIGNlbGxzIHRoYXQgYXJlIGVtcHR5XG5cblx0bGV0IGhhc0NoYW5nZXM6IGJvb2xlYW47IC8vIFdoZW4gY2hhbmdlcyBhcmUgbWFkZSB0aGUgd2hpbGUgbG9vcCBuZWVkcyB0byBiZSBleGVjdXRlZCBhZ2FpbiFcblx0Y29uc3QgbWF4SXRlcmF0aW9ucyA9IDEwMDsgLy8gcHJldmVudGluZyBpbmZpbml0ZSBsb29wIChzYWZlZ3VhcmQpXG5cdGxldCBpdGVyYXRpb24gPSAwO1xuXG5cdGRvIHtcblx0XHQvLyBmaXJzdCBpdGVyYXRpb24gaW5pdGlhbGxpemVzIGFsbCBlbXB0eSBjZWxscyB3aXRoIHRoZSBwb3NzaWJsZSBOdW1iZXJzIDEtOVxuXHRcdGhhc0NoYW5nZXMgPSBmYWxzZTsgLy8gUmVzZXQgdGhlIGZsYWcgYmVmb3JlIGVhY2ggaXRlcmF0aW9uXG5cdFx0Ly8gYWxsRnJlZUNlbGxzID0gZmluZEVtcHR5Q2VsbHMoZ3JpZCk7XG5cblx0XHRmb3IgKGxldCBpID0gMDsgaSA8IGFsbEZyZWVDZWxscy5sZW5ndGg7IGkrKykge1xuXHRcdFx0Y29uc3QgY2VsbDogQ2VsbCA9IGFsbEZyZWVDZWxsc1tpXTtcblx0XHRcdGNvbnN0IHBvc3NpYmxlVmFsdWVzQmVmb3JlU2VhcmNoID0gY2VsbC5nZXRQb3NzaWJsZVZhbHVlcygpO1xuXHRcdFx0Y29uc3QgcG9zc2libGVWYWx1ZXNBZnRlclNlYXJjaCA9IGdldFBvc3NpYmxlVmFsdWVzRm9yQ2VsbChjZWxsLmNsb25lKCksIGdyaWQpO1xuXHRcdFx0Ly8gY3JlYXRlIGEgbmV3IGNlbGwgRWxlbWVudCBvciBlbHNlIHRoZSBhbGdvcml0aG0gd29ya3Mgb24gYSByZWZlcmVuY2UhXG5cdFx0XHQvLyB0aGVyZWJ5IHBvc3NpYmxlIFZhbHVlcyBiZWZvcmUvYWZ0ZXIgd291bGQgYWx3YXlzIGJlIHRoZSBzYW1lXG5cblx0XHRcdGlmIChwb3NzaWJsZVZhbHVlc0FmdGVyU2VhcmNoLmxlbmd0aCA9PT0gMSkge1xuXHRcdFx0XHRjb25zdCB2YWx1ZSA9IHBvc3NpYmxlVmFsdWVzQWZ0ZXJTZWFyY2hbMF07XG5cdFx0XHRcdGNvbnN0IHJvdyA9IGNlbGwuZ2V0Um93KCk7XG5cdFx0XHRcdGNvbnN0IGNvbHVtbiA9IGNlbGwuZ2V0Q29sdW1uKCk7XG5cdFx0XHRcdGdyaWRbcm93XVtjb2x1bW5dID0gdmFsdWU7IC8vIFVwZGF0ZSB0aGUgdmFsdWUgaW4gdGhlIGdyaWRcblx0XHRcdFx0YWxsRnJlZUNlbGxzLnNwbGljZShpLCAxKTtcblx0XHRcdFx0aS0tOyAvLyBzaW5jZSBvbmUgZWxlbWVudCBpcyBkZWxldGVkIHdlIHdvdWxkIHNraXAgYSBmcmVlIGNlbGwgaWYgbm90IHJlZHVjaW5nIGkgYnkgb25lXG5cdFx0XHRcdGhhc0NoYW5nZXMgPSB0cnVlOyAvLyBTZXQgdGhlIGZsYWcgaWYgYSBjaGFuZ2Ugd2FzIG1hZGVcblx0XHRcdC8vIGlmIHdlIGFkZGVkIGEgdmFsdWUgdG8gdGhlIGdyaWQgd2UgY2FuIGRpc3JlZ2FyZCBpdCdzIHBvc3NpYmlsaXRpZXMgc2luY2UgdGhleSBhcmUgbm8gbG9uZ2VyIHJlbGV2YW50XG5cdFx0XHR9IGVsc2UgaWYgKCFhcnJheXNFcXVhbChwb3NzaWJsZVZhbHVlc0JlZm9yZVNlYXJjaCwgcG9zc2libGVWYWx1ZXNBZnRlclNlYXJjaCkpIHtcblx0XHRcdFx0Y2VsbC5zZXRQb3NzaWJsZVZhbHVlcyhwb3NzaWJsZVZhbHVlc0FmdGVyU2VhcmNoKTtcblx0XHRcdFx0aGFzQ2hhbmdlcyA9IHRydWU7IC8vIFNldCB0aGUgZmxhZyBpZiBhIGNoYW5nZSB3YXMgbWFkZVxuXHRcdFx0fVxuXHRcdH1cblx0XHRjb25zb2xlLmxvZyhgJHtpdGVyYXRpb259YClcblx0XHRpdGVyYXRpb24rKztcblx0fSB3aGlsZSAoKGFsbEZyZWVDZWxscy5sZW5ndGggPiAwICYmIGhhc0NoYW5nZXMpICYmIGl0ZXJhdGlvbiA8IG1heEl0ZXJhdGlvbnMpO1xuXG5cdHJldHVybiBncmlkO1xufVxuXG5cbi8qKlxuICogdGhpcyBmdW5jdGlvbiBkb2VzIG5vdCBjYXJlIGFib3V0IHBvc3NpYmxlIFZhbHVlcy5cbiAqIE9ubHkgdXNlZCB0byBmaW5kIHRoZSBlbXBseSBjZWxsc1xuICogQHBhcmFtIHdpdGhHcmlkIFxuICogQHJldHVybnMgRm9yIGVhY2ggY2VsbCA9PT0gMCAtLT4gW3JvdywgY29sdW1uLCBbXV1cbiAqL1xuY29uc3QgZmluZEVtcHR5Q2VsbHMgPSAod2l0aEdyaWQ6IG51bWJlcltdW10pOiBDZWxsW10gPT4ge1xuXHRsZXQgZnJlZUNlbGxzOiBDZWxsW10gPSBbXTtcblxuXHRmb3IgKGxldCBpID0gMDsgaSA8PSA4OyBpKyspIHtcblx0XHRmb3IgKGxldCBqID0gMDsgaiA8PSA4OyBqKyspIHtcblx0XHRcdGlmICh3aXRoR3JpZFtpXVtqXSA9PT0gMCkge1xuXHRcdFx0XHRjb25zdCBjZWxsID0gbmV3IENlbGwoaSwgaiwgWzEsMiwzLDQsNSw2LDcsOCw5XSk7XG5cdFx0XHRcdGZyZWVDZWxscy5wdXNoKGNlbGwpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXHRyZXR1cm4gZnJlZUNlbGxzO1xufVxuXG4vKipcbiAqIGJhc2ljIFN1ZG9rdSBydWxlcyAvICdoaWRkZW4gc2luZ2xlJ1xuICogQHBhcmFtIGNlbGxcbiAqIEBwYXJhbSBncmlkIFxuICogQHJldHVybnMgcG9zc2libGUgdmFsdWVzIGZvciBhIHNwZWNpZmljIGNlbGxcbiAqL1xuY29uc3QgZ2V0UG9zc2libGVWYWx1ZXNGb3JDZWxsID0gKGNlbGw6IENlbGwsIGdyaWQ6IG51bWJlcltdW10pOiBudW1iZXJbXSA9PiB7XG5cdGxldCBwb3NzaWJsZVZhbHVlczogbnVtYmVyW10gPSBbMSwgMiwgMywgNCwgNSwgNiwgNywgOCwgOV07XG5cblx0aWYoY2VsbC5nZXRQb3NzaWJsZVZhbHVlcygpLmxlbmd0aCA+IDEpIHtcblx0XHRwb3NzaWJsZVZhbHVlcyA9IGFwcGx5TmFrZWRTaW5nbGUoY2VsbCwgZ3JpZCk7XG5cdH1cblxuXHRpZihjZWxsLmdldFBvc3NpYmxlVmFsdWVzKCkubGVuZ3RoID4gMSkge1xuXHRcdHBvc3NpYmxlVmFsdWVzID0gYXBwbHlIaWRkZW5TaW5nbGUoY2VsbCwgZ3JpZCk7XG5cdH1cblxuXHQvLyBpZihjZWxsLmdldFBvc3NpYmxlVmFsdWVzKCkubGVuZ3RoID4gMSkge1xuXHQvLyBcdHBvc3NpYmxlVmFsdWVzID0gYXBwbHlQb2ludGluZ1BhaXJzKGNlbGwsIGdyaWQpO1xuXHQvLyB9XG5cblx0cmV0dXJuIHBvc3NpYmxlVmFsdWVzO1xufVxuXG5leHBvcnQgeyBmaW5kTnVtYmVycyB9O1xuIiwiaW1wb3J0IHsgQ2VsbCB9IGZyb20gXCIuL0NlbGxcIjtcblxuLyoqXG4gKiBoaWRkZW4gU2luZ2xlOiBzaW1wbGUgVGVjaG5pcXVlOlxuICogYSBjZWxsIG9ubHkgaGFzIG9uZSBwb3NzaWJsZSB2YWx1ZVxuICogZm9yIGEgZGVlcGVyIHVuZGVyc3RhbmRpbmc6IGh0dHBzOi8vc3Vkb2t1LmNvbS9zdWRva3UtcnVsZXMvaGlkZGVuLXNpbmdsZXMvIFxuICogQHBhcmFtIGNlbGwgXG4gKiBAcGFyYW0gZ3JpZCBcbiAqIEByZXR1cm5zIHBvc3NpYmxlTnVtYmVyczogbnVtYmVyW10gLS0+IGFjY29yZGluZyB0byB0aGUgbmFrZWQgU2luZ2xlIGFsZ29yaXRobVxuICovXG5jb25zdCBhcHBseUhpZGRlblNpbmdsZSA9IChjZWxsOiBDZWxsLCBncmlkOiBudW1iZXJbXVtdKTogbnVtYmVyW10gPT4ge1xuXG4gICAgY29uc3Qgcm93ID0gY2VsbC5nZXRSb3coKTtcbiAgICBjb25zdCBjb2x1bW4gPSBjZWxsLmdldENvbHVtbigpO1xuICAgIGNvbnN0IGJveCA9IGNlbGwuZ2V0Qm94KCk7XG4gICAgY29uc3QgcG9zc2libGVWYWx1ZXMgPSBjZWxsLmdldFBvc3NpYmxlVmFsdWVzKCk7XG5cbiAgICAvLyBDaGVjayBmb3IgbmFrZWQgc2luZ2xlcyBpbiB0aGUgcm93XG4gICAgZm9yIChsZXQgYyA9IDA7IGMgPCA5OyBjKyspIHtcbiAgICAgICAgaWYgKGMgIT09IGNvbHVtbiAmJiBncmlkW3Jvd11bY10gPT09IDApIHtcbiAgICAgICAgICAgIC8vIGZvciB0aGlzIHRvIHdvcmsgZ3JpZCB3b3VsZCBuZWVkIHRvIGJlIGFuIG9iamVjdCB3aXRoIGFuIGFycmF5IG9mIDgxIGNlbGxzIVxuICAgICAgICAgICAgLy8gd29ydGggaW1wbGVtZW50aW5nP1xuICAgICAgICAgICAgY29uc3QgY29sQ2VsbCA9IG5ldyBDZWxsKHJvdywgYywgW2dyaWRbcm93XVtjXV0pO1xuICAgICAgICAgICAgY29uc3QgY29sUG9zc2libGVWYWx1ZXMgPSBjb2xDZWxsLmdldFBvc3NpYmxlVmFsdWVzKCk7XG4gICAgICAgICAgICBwb3NzaWJsZVZhbHVlcy5mb3JFYWNoKHZhbHVlID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoY29sUG9zc2libGVWYWx1ZXMuaW5jbHVkZXModmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gcG9zc2libGVWYWx1ZXMuaW5kZXhPZih2YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIHBvc3NpYmxlVmFsdWVzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBDaGVjayBmb3IgbmFrZWQgc2luZ2xlcyBpbiB0aGUgY29sdW1uXG4gICAgZm9yIChsZXQgciA9IDA7IHIgPCA5OyByKyspIHtcbiAgICAgICAgaWYgKHIgIT09IHJvdyAmJiBncmlkW3JdW2NvbHVtbl0gPT09IDApIHtcbiAgICAgICAgICAgIGNvbnN0IHJvd0NlbGwgPSBuZXcgQ2VsbChyLCBjb2x1bW4sIFtncmlkW3JdW2NvbHVtbl1dKTtcbiAgICAgICAgICAgIGNvbnN0IHJvd1Bvc3NpYmxlVmFsdWVzID0gcm93Q2VsbC5nZXRQb3NzaWJsZVZhbHVlcygpO1xuICAgICAgICAgICAgcG9zc2libGVWYWx1ZXMuZm9yRWFjaCh2YWx1ZSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHJvd1Bvc3NpYmxlVmFsdWVzLmluY2x1ZGVzKHZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IHBvc3NpYmxlVmFsdWVzLmluZGV4T2YodmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICBwb3NzaWJsZVZhbHVlcy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgZm9yIG5ha2VkIHNpbmdsZXMgaW4gdGhlIGJveFxuICAgIGNvbnN0IHN0YXJ0Um93ID0gTWF0aC5mbG9vcihyb3cgLyAzKSAqIDM7XG4gICAgY29uc3Qgc3RhcnRDb2wgPSBNYXRoLmZsb29yKGNvbHVtbiAvIDMpICogMztcbiAgICBmb3IgKGxldCByID0gc3RhcnRSb3c7IHIgPCBzdGFydFJvdyArIDM7IHIrKykge1xuICAgICAgICBmb3IgKGxldCBjID0gc3RhcnRDb2w7IGMgPCBzdGFydENvbCArIDM7IGMrKykge1xuICAgICAgICAgICAgaWYgKHIgIT09IHJvdyAmJiBjICE9PSBjb2x1bW4gJiYgZ3JpZFtyXVtjXSA9PT0gMCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGJveENlbGwgPSBuZXcgQ2VsbChyLCBjLCBbZ3JpZFtyXVtjXV0pO1xuICAgICAgICAgICAgICAgIGNvbnN0IGJveFBvc3NpYmxlVmFsdWVzID0gYm94Q2VsbC5nZXRQb3NzaWJsZVZhbHVlcygpO1xuICAgICAgICAgICAgICAgIHBvc3NpYmxlVmFsdWVzLmZvckVhY2godmFsdWUgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoYm94UG9zc2libGVWYWx1ZXMuaW5jbHVkZXModmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IHBvc3NpYmxlVmFsdWVzLmluZGV4T2YodmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcG9zc2libGVWYWx1ZXMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gVXBkYXRlIHRoZSBwb3NzaWJsZSB2YWx1ZXMgb2YgdGhlIGNlbGxcbiAgICBjZWxsLnNldFBvc3NpYmxlVmFsdWVzKHBvc3NpYmxlVmFsdWVzKTtcblxuICAgIHJldHVybiBwb3NzaWJsZVZhbHVlcztcbn1cblxuZXhwb3J0IHsgYXBwbHlIaWRkZW5TaW5nbGUgfTtcbiIsImltcG9ydCB7IENlbGwgfSBmcm9tIFwiLi9DZWxsXCI7XG5cbi8qKlxuICogbmFrZWQgU2luZ2xlOiBzaW1wbGUgVGVjaG5pcXVlOlxuICogYSBjZWxsIHdpdGggYSBwb3NzaWJsZSBWYWx1ZSB0aGF0IGlzIHRoZSBvbmx5IG9uZSBvZiBpdCdzIGtpbmQgYW4gZW50aXJlIHJvdywgY29sdW1uIG9yIGJveFxuICogQHBhcmFtIGNlbGwgXG4gKiBAcGFyYW0gZ3JpZCBcbiAqIEByZXR1cm5zIHBvc3NpYmxlVmFsdWVzOiBudW1iZXJbXSBhY2NvcmRpbmcgdG8gdGhlIG5ha2VkIFNpbmdsZSB0YWN0aWMgXG4gKi9cbmNvbnN0IGFwcGx5TmFrZWRTaW5nbGUgPSAoY2VsbDogQ2VsbCwgZ3JpZDogbnVtYmVyW11bXSk6IG51bWJlcltdID0+IHtcblxuICAgIGNvbnN0IHJvdyA9IGNlbGwuZ2V0Um93KCk7XG4gICAgY29uc3QgY29sdW1uID0gY2VsbC5nZXRDb2x1bW4oKTtcbiAgICBjb25zdCBib3ggPSBjZWxsLmdldEJveCgpO1xuICAgIGNvbnN0IHBvc3NpYmxlVmFsdWVzOiBudW1iZXJbXSA9IGNlbGwuZ2V0UG9zc2libGVWYWx1ZXMoKTtcblxuICAgIC8vIFJlbW92ZSB2YWx1ZXMgYWxyZWFkeSBwcmVzZW50IGluIHRoZSBzYW1lIHJvd1xuICAgIGZvciAobGV0IGMgPSAwOyBjIDwgOTsgYysrKSB7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gZ3JpZFtyb3ddW2NdO1xuICAgICAgICBpZiAodmFsdWUgIT09IDAgJiYgcG9zc2libGVWYWx1ZXMuaW5jbHVkZXModmFsdWUpKSB7XG4gICAgICAgICAgICBjb25zdCBpbmRleCA9IHBvc3NpYmxlVmFsdWVzLmluZGV4T2YodmFsdWUpO1xuICAgICAgICAgICAgcG9zc2libGVWYWx1ZXMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIFJlbW92ZSB2YWx1ZXMgYWxyZWFkeSBwcmVzZW50IGluIHRoZSBzYW1lIGNvbHVtblxuICAgIGZvciAobGV0IHIgPSAwOyByIDwgOTsgcisrKSB7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gZ3JpZFtyXVtjb2x1bW5dO1xuICAgICAgICBpZiAodmFsdWUgIT09IDAgJiYgcG9zc2libGVWYWx1ZXMuaW5jbHVkZXModmFsdWUpKSB7XG4gICAgICAgICAgICBjb25zdCBpbmRleCA9IHBvc3NpYmxlVmFsdWVzLmluZGV4T2YodmFsdWUpO1xuICAgICAgICAgICAgcG9zc2libGVWYWx1ZXMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIFJlbW92ZSB2YWx1ZXMgYWxyZWFkeSBwcmVzZW50IGluIHRoZSBzYW1lIGJveFxuICAgIGNvbnN0IGJveFJvdyA9IE1hdGguZmxvb3IoYm94IC8gMykgKiAzO1xuICAgIGNvbnN0IGJveENvbHVtbiA9IChib3ggJSAzKSAqIDM7XG4gICAgZm9yIChsZXQgciA9IGJveFJvdzsgciA8IGJveFJvdyArIDM7IHIrKykge1xuICAgICAgICBmb3IgKGxldCBjID0gYm94Q29sdW1uOyBjIDwgYm94Q29sdW1uICsgMzsgYysrKSB7XG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGdyaWRbcl1bY107XG4gICAgICAgICAgICBpZiAodmFsdWUgIT09IDAgJiYgcG9zc2libGVWYWx1ZXMuaW5jbHVkZXModmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSBwb3NzaWJsZVZhbHVlcy5pbmRleE9mKHZhbHVlKTtcbiAgICAgICAgICAgICAgICBwb3NzaWJsZVZhbHVlcy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBwb3NzaWJsZVZhbHVlcztcbn1cblxuZXhwb3J0IHsgYXBwbHlOYWtlZFNpbmdsZSB9IiwiaW1wb3J0IHsgZ2V0Q3VycmVudEdyaWQgfSBmcm9tIFwiLi4vR2V0dGVyL2dldEdyaWRcIjtcbmltcG9ydCB7IGZpbmROdW1iZXJzIH0gZnJvbSBcIi4vZmluZE1pc3NpbmdOdW1iZXJzXCI7XG5pbXBvcnQgeyBjbGVhckJvYXJkLCBkZWxldGVCb2FyZCB9IGZyb20gXCIuLi9NYW5hZ2luZ0dyaWQvY2xlYXJcIjtcbmltcG9ydCB7IGNyZWF0ZUJvYXJkIH0gZnJvbSBcIi4uL01hbmFnaW5nR3JpZC9jcmVhdGVcIjtcblxuY29uc3Qgc29sdmVHcmlkID0gKCkgPT4ge1xuICAgIGxldCBjdXJyZW50R3JpZCA9IGdldEN1cnJlbnRHcmlkKCk7XG4gICAgbGV0IHJlc3VsdGluZ0dyaWQgPSBmaW5kTnVtYmVycyhjdXJyZW50R3JpZCk7XG4gICAgZGVsZXRlQm9hcmQoKTtcbiAgICBjcmVhdGVCb2FyZChyZXN1bHRpbmdHcmlkKTtcbn1cblxuZXhwb3J0IHsgc29sdmVHcmlkIH0iLCIvLyBUaGUgbW9kdWxlIGNhY2hlXG52YXIgX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fID0ge307XG5cbi8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG5mdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuXHR2YXIgY2FjaGVkTW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXTtcblx0aWYgKGNhY2hlZE1vZHVsZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0cmV0dXJuIGNhY2hlZE1vZHVsZS5leHBvcnRzO1xuXHR9XG5cdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG5cdHZhciBtb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdID0ge1xuXHRcdC8vIG5vIG1vZHVsZS5pZCBuZWVkZWRcblx0XHQvLyBubyBtb2R1bGUubG9hZGVkIG5lZWRlZFxuXHRcdGV4cG9ydHM6IHt9XG5cdH07XG5cblx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG5cdF9fd2VicGFja19tb2R1bGVzX19bbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG5cdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG5cdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbn1cblxuIiwiaW1wb3J0IHsgY2hlY2tHcmlkIH0gZnJvbSBcIi4vQ2hlY2tpbmdHcmlkL2NoZWNraW5nR3JpZFwiO1xuaW1wb3J0IHsgY3JlYXRlQm9hcmQgfSBmcm9tIFwiLi9NYW5hZ2luZ0dyaWQvY3JlYXRlXCI7XG5pbXBvcnQgeyBjbGVhckJvYXJkIH0gZnJvbSBcIi4vTWFuYWdpbmdHcmlkL2NsZWFyXCI7XG5pbXBvcnQgeyB1bmRvU3RlcCB9IGZyb20gXCIuL01hbmFnaW5nR3JpZC91bmRvXCI7XG5pbXBvcnQgKiBhcyBSYW5kb21HcmlkIGZyb20gXCIuL1JlcG9zaXRvcnkvZ2V0dGluZ1JhbmRvbUdyaWRcIjtcbmltcG9ydCAqIGFzIFJlcG8gZnJvbSBcIi4vUmVwb3NpdG9yeS9UZXN0aW5nR3JpZHMvc3Vkb2t1VGVzdEdyaWRcIjtcbmltcG9ydCAqIGFzIFRlc3RHcmlkcyBmcm9tIFwiLi9SZXBvc2l0b3J5L1Rlc3RpbmdHcmlkcy90ZXN0U29sdmluZ1wiO1xuaW1wb3J0IHsgc29sdmVHcmlkIH0gZnJvbSBcIi4vc29sdmVHcmlkL3NvbHZlXCI7XG4vLyBpbXBvcnQgeyBnZXRDdXJyZW50R3JpZCB9IGZyb20gXCIuL0dldHRlci9nZXRHcmlkXCI7XG5cbi8vIGRlYnVnZ2VyOyBcbi8vIGxpbnQ7IHpvZDsgcHJldHRpZXIgbGlicyBcblxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLWJ1dHRvbnMtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbmNvbnN0IGNsZWFyQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGNsZWFyYCk7XG5pZihjbGVhckJ1dHRvbiAhPT0gbnVsbCkgY2xlYXJCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihgY2xpY2tgLCBjbGVhckJvYXJkKTtcbmVsc2UgYWxlcnQoYHdlJ3ZlIGdvdCBhIHByb2JsZW0gd2l0aCB0aGUgY2hlY2sgYnV0dG9uIDovYCk7XG5cbmNvbnN0IGNoZWNrZXJCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNoZWNrXCIpO1xuaWYoY2hlY2tlckJ1dHRvbiAhPT0gbnVsbCkgY2hlY2tlckJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgY2hlY2tHcmlkKTtcbmVsc2UgYWxlcnQoYHdlJ3ZlIGdvdCBhIHByb2JsZW0gd2l0aCB0aGUgY2hlY2sgYnV0dG9uYCk7XG5cbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBmdW5jdGlvbihlKSB7XG4gICAgaWYgKGUua2V5ID09PSBcInpcIiAmJiBlLmN0cmxLZXkgPT09IHRydWUpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAvLyBFeGVjdXRlIFVuZG8gZnVuY3Rpb24gd2hlbiBzdHJnK3UgaXMgcHJlc3NlZFxuICAgICAgICB1bmRvU3RlcCgpO1xuICAgIH1cbn0pO1xuXG5jb25zdCB1bmRvQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHVuZG9gKTtcbmlmKHVuZG9CdXR0b24gIT09IG51bGwpIHtcbiAgICB1bmRvQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB1bmRvU3RlcCk7ICAgICBcbn0gZWxzZSBhbGVydChgd2UndmUgZ290IGEgcHJvYmxlbSB3aXRoIHRoZSB1bmRvIGJ1dHRvbmApO1xuXG5jb25zdCBzb2x2ZUJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzb2x2ZScpO1xuaWYoc29sdmVCdXR0b24gIT09IG51bGwgfHwgc29sdmVCdXR0b24gIT09IHVuZGVmaW5lZCkge1xuICAgIHNvbHZlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc29sdmVHcmlkKTtcbn0gZWxzZSBhbGVydChgd2UndmUgZ290IGEgcHJvYmxlbSB3aXRoIHRoZSB1bmRvIGJ1dHRvbmApO1xuXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1leGVjdXRpbmctLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuLy8gY3JlYXRlQm9hcmQoUmFuZG9tR3JpZC5nZXRSYW5kb21IYXJkR3JpZCgpKTtcbi8vIGNyZWF0ZUJvYXJkKFJhbmRvbUdyaWQuZ2V0UmFuZG9tTWVkaXVtR3JpZCgpKTtcbi8vIGNyZWF0ZUJvYXJkKFJhbmRvbUdyaWQuZ2V0UmFuZG9tRWFzeUdyaWQoKSk7XG5jcmVhdGVCb2FyZChUZXN0R3JpZHMudGVzdE5ha2VkU2luZ2xlKTtcbiJdLCJuYW1lcyI6WyJjaGVja0dyaWQiLCJvdXRwdXQiLCJnIiwiZ2V0Q3VycmVudEdyaWQiLCJhbGVydCIsImdyaWRJc0Z1bGwiLCJjaGVja1Jvd3NBbmRDb2x1bW5zIiwiY2hlY2tCb3hlcyIsImkiLCJqIiwiY3VycmVudEdyaWQiLCJjb3VudGVyUm93cyIsIkFycmF5IiwiZmlsbCIsImNvdW50ZXJDb2x1bW5zIiwibnVtUm93IiwibnVtQ29sIiwiYm94Q2hlY2tIZWxwZXIiLCJmcm9tUm93IiwidG9Sb3ciLCJmcm9tQ29sdW1uIiwidG9Db2x1bW4iLCJjb3VudGVyIiwibnVtIiwiZ3JpZCIsImNlbGxzIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwidGVtcCIsIkhUTUxFbGVtZW50IiwidGVtcE51bSIsImlubmVyVGV4dCIsIk51bWJlciIsImRlbGV0ZUJvYXJkIiwiZ2V0RWxlbWVudEJ5SWQiLCJsYXN0Q2hpbGQiLCJyZW1vdmVDaGlsZCIsImNsZWFyQm9hcmQiLCJjcmVhdGVCb2FyZCIsImNyZWF0ZVZvaWRHcmlkIiwid2l0aEdyaWQiLCJmb3JFYWNoIiwiZWxlbSIsInJvd0luZGV4Iiwicm93IiwiY3JlYXRlRWxlbWVudCIsImNsYXNzTGlzdCIsImFkZCIsInNldEF0dHJpYnV0ZSIsImFwcGVuZCIsInZhbHVlIiwiY29sSW5kZXgiLCJjZWxsIiwiYWRkRXZlbnRMaXN0ZW5lciIsImFkZE51bWJlciIsInRvU3RyaW5nIiwiZXZlbnQiLCJ0YXJnZXQiLCJnZXRBdHRyaWJ1dGUiLCJjb2x1bW4iLCJxdWVyeVNlbGVjdG9yIiwicHJvbXQiLCJwcm9tcHQiLCJwYXJzZUludCIsImlzTmFOIiwibnVtYmVyQmVmb3JlQ2hhbmdlIiwiaW5uZXJIVE1MIiwidW5kb1N0YWNrIiwicHVzaCIsImNhcGFjaXR5IiwiaXRlbSIsInRoaXMiLCJpc0Z1bGwiLCJFcnJvciIsInN0b3JhZ2UiLCJwb3AiLCJwZWVrIiwic2l6ZSIsImxlbmd0aCIsInVuZG9TdGVwIiwidW5kZWZpbmVkIiwic3RyIiwiYXJyIiwiY29uc29sZSIsImxvZyIsInRlc3ROYWtlZFNpbmdsZSIsInBvc3NpYmxlc1ZhbHVlcyIsImJveCIsIk1hdGgiLCJmbG9vciIsInBvc3NpYmxlVmFsdWVzIiwiZ2V0Um93IiwiZ2V0Q29sdW1uIiwiZ2V0Qm94IiwiZ2V0UG9zc2libGVWYWx1ZXMiLCJzZXRQb3NzaWJsZVZhbHVlcyIsImNsb25lIiwiQ2VsbCIsImFycmF5c0VxdWFsIiwiYSIsImIiLCJmaW5kTnVtYmVycyIsImhhc0NoYW5nZXMiLCJhbGxGcmVlQ2VsbHMiLCJmaW5kRW1wdHlDZWxscyIsIml0ZXJhdGlvbiIsInBvc3NpYmxlVmFsdWVzQmVmb3JlU2VhcmNoIiwicG9zc2libGVWYWx1ZXNBZnRlclNlYXJjaCIsImdldFBvc3NpYmxlVmFsdWVzRm9yQ2VsbCIsInNwbGljZSIsImZyZWVDZWxscyIsImFwcGx5TmFrZWRTaW5nbGUiLCJhcHBseUhpZGRlblNpbmdsZSIsImMiLCJpbmNsdWRlcyIsImluZGV4IiwiaW5kZXhPZiIsInIiLCJzdGFydFJvdyIsInN0YXJ0Q29sIiwiYm94Um93IiwiYm94Q29sdW1uIiwic29sdmVHcmlkIiwicmVzdWx0aW5nR3JpZCIsIl9fd2VicGFja19tb2R1bGVfY2FjaGVfXyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImNhY2hlZE1vZHVsZSIsImV4cG9ydHMiLCJtb2R1bGUiLCJfX3dlYnBhY2tfbW9kdWxlc19fIiwiY2FsbCIsImNsZWFyQnV0dG9uIiwiY2hlY2tlckJ1dHRvbiIsIndpbmRvdyIsImUiLCJrZXkiLCJjdHJsS2V5IiwicHJldmVudERlZmF1bHQiLCJ1bmRvQnV0dG9uIiwic29sdmVCdXR0b24iLCJUZXN0R3JpZHMiXSwic291cmNlUm9vdCI6IiJ9